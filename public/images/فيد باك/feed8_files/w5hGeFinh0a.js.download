;/*FB_PKG_DELIM*/

__d("MAWChunkedObservableTypes.flow",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=.5;c=b("$InternalEnum").Mirrored(["LAZY","FIRING","FIRED"]);f.LOAD_FACTOR=a;f.ChunkResultState=c}),66);
__d("MAWDatabaseInteractionTracing",["interaction-tracing"],(function(a,b,c,d,e,f,g){"use strict";function a(a){c("interaction-tracing").InteractionTracingCore.getPendingInteractions().forEach(function(b){b.addSubspan("MAWLiveQuery_"+a.callsite,"AppTiming",a.startSinceEpoch,a.endSinceEpoch,{full_duration:(a.endSinceEpoch-a.startSinceEpoch)/1e3})})}g.recordLiveQuery=a}),98);
__d("MAWFanOutObservable",["relay-runtime/network/RelayObservable","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){b===void 0&&(b={});b=b;var d=b.initialValue;b=b.skipMemo;var e=b===void 0?!1:b,f={state:"empty"},g=null,h=new Set(),i=function(a){switch(f.state){case"val":a.next(f.value);break;case"err":a.error(f.value);break;case"complete":a.complete()}},j=function(){h.forEach(function(a){return i(a)})};return c("relay-runtime/network/RelayObservable").create(function(b){h.add(b);g||(g=a.subscribe({complete:function(){f={state:"complete"},j()},error:function(a){f={state:"err",value:a},j()},next:function(a){f={state:"val",value:a},j()}}));d!==void 0&&f.state==="empty"&&(f={state:"val",value:d});e||i(b);return function(){h["delete"](b),c("setTimeout")(function(){if(h.size===0){var a;(a=g)==null?void 0:a.unsubscribe();g=null}},0)}})}g.buildFanoutObservable=a}),98);
__d("MAWLiveQuery",["FBLogger","MAWDatabaseInteractionTracing","MAWDexie","MAWFanOutObservable","MAWThrottleLiveQuery","Promise","cr:11978","cr:1265","performanceNow","qex","relay-runtime/network/RelayObservable"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("relay-runtime/network/RelayObservable").create(function(a){});function k(a){return d("MAWDexie").liveQuery(a)}function l(){var a;return d("MAWDexie").Promise==null?void 0:(a=d("MAWDexie").Promise.PSD)==null?void 0:a.subscr}function m(a,d){return function(){d.start=Date.now();d.startSinceEpoch=(i||(i=c("performanceNow")))();return a().then(function(a){d.queryEnd=Date.now();if(b("cr:1265")!=null){var c;d.keyRanges=(c=b("cr:11978")==null?void 0:b("cr:11978").getObservabilitySets(l()))!=null?c:{};d.result=o(a)}return a})}}var n=3;function o(a){return Array.isArray(a)&&a.length>n?[].concat(a.slice(0,n-1),["<truncated...>",a[a.length-1]]):a}function a(a,b){return(typeof a==="function"?a():a)?b():j}function e(a,b,c){var e=p(a,b,c,arguments[3]);return d("MAWFanOutObservable").buildFanoutObservable(e)}function p(a,e,f,g){if(!a)return j;var l=(g=g)!=null?g:"<unknown>",n={callsite:l,end:0,endSinceEpoch:0,keyRanges:{},queryEnd:0,result:void 0,start:0,startSinceEpoch:0,transformedResult:void 0};g=m(function(){return e(a)},n);var p=c("qex")._("481")?d("MAWThrottleLiveQuery").createThrottledMAWObservable(g,{leading:!0,maximumTimeBetweenInvocation:2e3,trailingWait:500}):k(g);return c("relay-runtime/network/RelayObservable").create(function(a){var e=p.subscribe({complete:a.complete,error:a.error,next:function(e){(h||(h=b("Promise"))).resolve(f(e)).then(function(e){n.end=Date.now(),n.endSinceEpoch=(i||(i=c("performanceNow")))(),b("cr:1265")!=null&&(n.transformedResult=o(e),b("cr:1265").recordLiveQuery(n)),d("MAWDatabaseInteractionTracing").recordLiveQuery(n),a.next(e)})["catch"](function(b){c("FBLogger")("messenger_e2ee_web").catching(b).mustfix("Dexie liveQuery value transformer failure in %s",l),a.error(b)})}});return function(){return e.unsubscribe()}})}function f(a){return a===j}g.emptyRelayObservable=j;g.liveQuery=k;g.maybeCreate=a;g.createMawObservable=e;g.createRawMAWObservable_DO_NOT_USE=p;g.isMAWLiveQueryEmptyRelayObservable=f}),98);
__d("MAWThrottleLiveQuery",["MAWDexie","MAWDexieTable","MAWLiveQuery","ReplayLastSubject","clearTimeout","relay-runtime/network/RelayObservable","setTimeout","switchMap"],(function(a,b,c,d,e,f,g){"use strict";function h(a){var b=null;return function(){if(b==null)return a().then(function(a){b={result:a,subscr:c("MAWDexie").Promise.PSD.subscr};return{cached:!1,value:a}});var e=b,f=e.result;e=e.subscr;Object.assign(c("MAWDexie").Promise.PSD.subscr,e);return d("MAWDexieTable").dexieResolve({cached:!0,value:f})}}function a(a,b){var e=new(d("ReplayLastSubject").ReplayLastSubject)({}),f=null,g=null,i=function(){c("clearTimeout")(g),g=null},j=function(){c("clearTimeout")(f),f=null},k=b.leading,l=function(){i(),j(),e.next({})};return c("switchMap")(e,function(){return c("relay-runtime/network/RelayObservable").create(function(e){var j=d("MAWLiveQuery").liveQuery(h(a)),m=j.subscribe({complete:e.complete,error:e.error,next:function(a){if(a.cached){if(k){k=!1;l();return}f==null&&b.maximumTimeBetweenInvocation!=null&&(f=c("setTimeout")(function(){l()},b.maximumTimeBetweenInvocation));i();g=c("setTimeout")(function(){k=b.leading,l()},b.trailingWait);return}e.next(a.value)}});return function(){m.unsubscribe()}})})}g.createThrottledMAWObservable=a}),98);
__d("MAWChunkedRangeObservableUtils",["MAWChunkedObservableTypes.flow","MAWLiveQuery","MAWObservableUtils","ReplayLastSubject","err","relay-runtime/network/RelayObservable","switchMap"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e,f,g,i){var j=function(){return c("relay-runtime/network/RelayObservable").create(function(a){})},k=i,l=function(){var c;c=d("MAWLiveQuery").createRawMAWObservable_DO_NOT_USE(e,function(c){return f(c)(a,b,g)},function(a){return{type:"T",val:a}},"MAWObservableChunk - "+((c=JSON.stringify(a))!=null?c:"?")+":"+((c=JSON.stringify(b))!=null?c:"?")+"["+g+"]");c=h(c,k);k=void 0;return c},m=new(d("ReplayLastSubject").ReplayLastSubject)(j());i=c("switchMap")(m,function(a){return a});var n={arr:{type:"T",val:[]},getUnusedPreloadedRows:function(){return k},makeActive:function(){n.status===d("MAWChunkedObservableTypes.flow").ChunkResultState.LAZY&&(n.status=d("MAWChunkedObservableTypes.flow").ChunkResultState.FIRING,m.next(l()))},makeLazy:function(){n.status!==d("MAWChunkedObservableTypes.flow").ChunkResultState.LAZY&&(n.status=d("MAWChunkedObservableTypes.flow").ChunkResultState.LAZY,m.next(j()))},status:d("MAWChunkedObservableTypes.flow").ChunkResultState.LAZY};return{obs:i,result:n}}function h(a,b){return c("relay-runtime/network/RelayObservable").create(function(c){var d=!1;(b==null?void 0:b.val.length)&&!d&&c.next(b);var e=a.subscribe({complete:c.complete,error:c.error,next:function(a){c.next(a)}});return function(){e.unsubscribe()}})}function b(a,b,c,d,e){a=a-(b-c.emittedResult.arr.val.length);b=0;while(a>0&&d[b]!=null)a-=e[b].count,d[b].emittedResult.makeActive(),b++;d.forEach(function(a,b){a.emittedResult.arr.val.length=e[b].count})}function e(a,b,c,e){var f=e.comparator,g=e.getSortKey,h=e.mapOutput,i=[],j=!1;for(var b=b.iterFront(),k=Array.isArray(b),l=0,b=k?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var m;if(k){if(l>=b.length)break;m=b[l++]}else{l=b.next();if(l.done)break;m=l.value}m=m;m=m.val;if(i.length>=a||f(m.start,c)>=0)break;switch(m.emittedResult.status){case d("MAWChunkedObservableTypes.flow").ChunkResultState.FIRING:return{shouldEmit:"EMIT_AFTER_FIRE"};case d("MAWChunkedObservableTypes.flow").ChunkResultState.LAZY:return{shouldEmit:"EMIT_AFTER_ACTIVATION"};case d("MAWChunkedObservableTypes.flow").ChunkResultState.FIRED:m=m.emittedResult.arr;m.type==="T"?!m.val.length||f(c,g(m.val[m.val.length-1]))>0?i.push.apply(i,m.val.map(h)):i.push.apply(i,m.val.filter(function(a){return f(c,g(a))>0}).map(h)):(j=!0,i.push.apply(i,m.val))}}if(j&&e.accumDedup){m=e.accumDedup();l=i.filter(m);return{output:l,shouldEmit:"EMIT"}}return{output:i,shouldEmit:"EMIT"}}function i(a,b,d){for(var e=a.length-2;e>0;e--){var f=d(a[e]),g=d(a[e+1]);if(b(f,g)!==0)return{dropping:a.length-e-2,safeEnd:f}}throw c("err")("Entire pagination window sorts identically: this should never happen.")}function f(a,b){var c=b.chunkSize,e=b.comparator,f=b.end,g=b.fetchSize,h=b.getSortKey,j=b.start,k=[],l;if(a.length<=c+c*d("MAWChunkedObservableTypes.flow").LOAD_FACTOR)k.push({count:a.length,end:f,start:j}),b=a;else{b=a.slice(0,g);var m=d("MAWObservableUtils").chunkArray(b,c,e,h);m.forEach(function(b,c){var d=m[c+1];c=c===0?j:h(b[0]);if(d==null)if(a.length>g){var n=i(a,e,h),o=n.dropping;n=n.safeEnd;o=b.length-o;k.push({count:o,end:n,start:c});l={count:0,end:f,start:n}}else k.push({count:b.length,end:f,start:c});else k.push({count:b.length,end:h(d[0]),start:c})})}return{extensionInterval:l,intervals:k,trimmedOutput:b}}g.createLazyChunkMAWObservable=a;g.activateOnlyRequiredNewTailRanges=b;g.getValsFromAllRanges=e;g.getSafeEndPoint=i;g.getNewIntervalsForRange=f}),98);
__d("MAWDoublyLinkedList",["MAWObservableUtils","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){this.$3=new Map(),this.$1=void 0,this.$2=void 0}var b=a.prototype;b.$4=function(a,b,c){b={next:b,prev:c,ref:d("MAWObservableUtils").getUniqueRef(),value:a};this.$3.set(b.ref,b);return b};b.pushFront=function(a){if(this.$2==null)this.$2=this.$1=this.$4(a);else{var b=this.$2;a=this.$4(a,b);b.prev=a;this.$2=a}return this.$2.ref};b.pushBack=function(a){if(this.$1==null)this.$1=this.$2=this.$4(a);else{var b=this.$1;a=this.$4(a,void 0,b);b.next=a;this.$1=a}return this.$1.ref};b.$5=function(a){var b=a==="front"?this.$2:this.$1,c=function(){if(b==null)return{done:!0,value:void 0};var c=b;b=a==="front"?b.next:b.prev;return{done:!1,value:c}},d=(c={next:c},c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]=function(){return d},c);return d};b.iterFront=function(){var a=this;return function*(){for(var b of a.$5("front"))yield h(b)}()};b.iterBack=function(){var a=this;return function*(){for(var b of a.$5("back"))yield h(b)}()};b.popFront=function(){if(this.$2==null)return;if(this.$2===this.$1){var a=this.$2;this.$3["delete"](this.$2.ref);this.$2=this.$1=void 0;return h(a)}a=this.$2;var b=c("nullthrows")(a.next);b.prev=void 0;this.$2=b;this.$3["delete"](a.ref);return h(a)};b.popBack=function(){if(this.$1==null)return;if(this.$2===this.$1){var a=this.$1;this.$3["delete"](this.$1.ref);this.$1=this.$2=void 0;return h(a)}a=this.$1;var b=c("nullthrows")(a.prev);b.next=void 0;this.$1=b;this.$3["delete"](a.ref);return h(a)};b.get=function(a){a=this.$3.get(a);if(a)return h(a)};b.next=function(a){a=(a=this.$3.get(a))==null?void 0:a.next;if(a)return h(a)};b.prev=function(a){a=(a=this.$3.get(a))==null?void 0:a.prev;if(a)return h(a)};b.mergeOver=function(a,b){var c=this;if(a.length===0)return[];var d=this.$3.get(b);if(d==null)return[];this.$3["delete"](b);b=d.prev;d=d.next;var e=b,f=[];a.forEach(function(a){a=c.$4(a,void 0,e);e!=null&&(e.next=a);e=a;f.push(a)});b==null?this.$2=f[0]:b.next=f[0];d==null?this.$1=f[f.length-1]:(d.prev=f[f.length-1],f[f.length-1].next=d);return f.map(function(a){return a.ref})};b.clear=function(){this.$2=void 0,this.$1=void 0,this.$3.clear()};babelHelpers.createClass(a,[{key:"size",get:function(){return this.$3.size}},{key:"first",get:function(){return this.$2?h(this.$2):void 0}},{key:"last",get:function(){return this.$1?h(this.$1):void 0}}]);return a}();function h(a){return{ref:a.ref,val:a.value}}g["default"]=a}),98);
__d("MAWChunkedRangeLoader",["MAWChunkedObservableTypes.flow","MAWChunkedRangeObservableUtils","MAWDoublyLinkedList","MAWFanOutObservable","MAWObservableUtils","err","nullthrows","relay-runtime/network/RelayObservable"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b,e,f,g){this.hasDb=!!a,this.$2=a,this.$3=b,this.$4=b/d("MAWChunkedObservableTypes.flow").LOAD_FACTOR,this.$8=f,this.$5=e.outputMapper,this.$6=e.getSortKey,this.$7=e.querier,this.$1=g?g():new(c("MAWDoublyLinkedList"))(),this.$9=h(f),this.$10=e.accumDedup}var b=a.prototype;b.queryRange=function(a,b,c,d){var e=this;c===void 0&&(c=Number.MAX_VALUE);if(d){var f=d.coverEntireRange;this.preloadRows(f?a:void 0,b,{type:"O",val:f?d.data:d.data.slice(1)})}d=(f=this.$1.last)==null?void 0:f.val.end;f=(f=this.$1.first)==null?void 0:f.val.start;var g=function(){e.$12()<c&&e.$13(c,b)};f==null||d==null||this.$9(a,f)!==0?(this.$1.clear(),this.$14(a,b),this.$13(c,b)):this.$9(b,d)>0?(this.$14(d,b,c),g()):this.$9(b,d)<0?this.$15(c,b):g();return this.$16(c,b)};b.preloadRows=function(a,b,e){var f;f=(f=this.$1.last)!=null?f:{val:null};f=f.val;if(a==null&&f==null)throw c("err")("Omitted start point for appending to an empty sequence.");if(e.type==="O"){var g;g=this.$17((g=f==null?void 0:f.end)!=null?g:a,b,e);this.$1.pushBack(g)}else{g=0;e=e.val;if(f!=null&&this.$9(this.$6(e[g]),f.end)<0)while(g<e.length&&this.$9(this.$6(e[g]),f.end)<0)g++;if(g===e.length)return;e=e.slice(g);b=d("MAWChunkedRangeObservableUtils").getNewIntervalsForRange(e,{chunkSize:this.$3,comparator:this.$9,end:b,fetchSize:Number.POSITIVE_INFINITY,getSortKey:this.$6,start:(g=a)!=null?g:c("nullthrows")(f==null?void 0:f.end)});a=b.intervals;g=0;for(f=a,b=Array.isArray(f),a=0,f=b?f:f[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(b){if(a>=f.length)break;h=f[a++]}else{a=f.next();if(a.done)break;h=a.value}h=h;var i=h.end,j=h.start;j=this.$17(j,i,{type:"T",val:e.slice(g,g+h.count)});g+=h.count;this.$1.pushBack(j)}}};b.$17=function(a,b,e){var f=this,g=2;g=this.$4+g;g=d("MAWChunkedRangeObservableUtils").createLazyChunkMAWObservable(a,b,this.$2,this.$7,g,e);var h=g.obs,i=g.result,j=function(a){i.status=d("MAWChunkedObservableTypes.flow").ChunkResultState.FIRED,i.arr=a};e=c("relay-runtime/network/RelayObservable").create(function(c){var e=h.subscribe({error:function(a){return c.error(a)},next:function(e){var g=e.type==="T"?d("MAWChunkedRangeObservableUtils").getNewIntervalsForRange(e.val,{chunkSize:f.$3,comparator:f.$9,end:b,fetchSize:f.$4,getSortKey:f.$6,start:a}):{extensionInterval:void 0,intervals:[{count:e.val.length,end:b,start:a}],trimmedOutput:e.val},h=g.trimmedOutput;g=babelHelpers.objectWithoutPropertiesLoose(g,["trimmedOutput"]);e={type:e.type,val:h};j(e);return c.next(g)}});return function(){return e.unsubscribe()}});return{emittedResult:i,end:b,observable:d("MAWFanOutObservable").buildFanoutObservable(e,{skipMemo:!0}),start:a}};b.$16=function(a,b){var e=this,f=c("relay-runtime/network/RelayObservable").create(function(g){var h=new Map(),i=function(){var c;c=d("MAWChunkedRangeObservableUtils").getValsFromAllRanges(a,e.$1,b,{accumDedup:(c=e.$10)!=null?c:void 0,comparator:e.$9,getSortKey:e.$6,mapOutput:e.$5});switch(c.shouldEmit){case"EMIT_AFTER_FIRE":break;case"EMIT_AFTER_ACTIVATION":e.$13(a,b);break;case"EMIT":c.output.length>a&&e.$15(a,b),g.next(c.output.slice(0,a))}},j=function(){for(var a=e.$1.iterFront(),b=Array.isArray(a),c=0,a=b?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{c=a.next();if(c.done)break;d=c.value}d=d;h.has(d.ref)||h.set(d.ref,l(d))}},k=function(){for(var a=h,b=Array.isArray(a),c=0,a=b?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var d;if(b){if(c>=a.length)break;d=a[c++]}else{c=a.next();if(c.done)break;d=c.value}d=d;var e=d[0];d=d[1];d.unsubscribe();h["delete"](e)}},l=function(b){var l=b.ref,m=b.val;return m.observable.subscribe({error:function(a){return g.error(a)},next:function(b){var g=b.extensionInterval;b=b.intervals;if(e.$11&&e.$11!==f){k();return}g||i();if(b.length>1){var n=b.map(function(a){var b=a.end;a=a.start;a=e.$17(a,b);return a});e.$1.next(l)==null?d("MAWChunkedRangeObservableUtils").activateOnlyRequiredNewTailRanges(a,e.$12(),m,n,b):n.forEach(function(a){return a.emittedResult.makeActive()});(b=h.get(l))==null?void 0:b.unsubscribe();h["delete"](l);b=e.$1.mergeOver(n,l);g&&e.$18(g,c("nullthrows")(e.$1.get(b[b.length-1])));j()}}})};j();i();return function(){return k()}});this.$11=f;return f};b.$14=function(a,b,c){var e;e=(e=this.$1.last)!=null?e:{ref:null,val:null};var f=e.ref;e=e.val;if(e&&e.emittedResult.status===d("MAWChunkedObservableTypes.flow").ChunkResultState.LAZY&&f!==null){var g=e.emittedResult.getUnusedPreloadedRows();e=this.$9(a,e.start)===0&&!!g&&typeof c==="number"&&g.val.length>=c;c=this.$17(a,b,e?g:void 0);this.$1.mergeOver([c],f)}else{e=this.$17(a,b);this.$1.pushBack(e)}};b.$13=function(a,b){a=a-this.$12()+this.$3;for(var c=this.$1.iterFront(),e=Array.isArray(c),f=0,c=e?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(e){if(f>=c.length)break;g=c[f++]}else{f=c.next();if(f.done)break;g=f.value}g=g;g=g.val;if(this.$9(g.start,b)>=0)break;g.emittedResult.status===d("MAWChunkedObservableTypes.flow").ChunkResultState.LAZY&&(g.emittedResult.makeActive(),a-=g.emittedResult.arr.val.length);if(a<=0)break}};b.$15=function(a,b){var c=0;for(var e=this.$1.iterFront(),f=Array.isArray(e),g=0,e=f?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(f){if(g>=e.length)break;h=e[g++]}else{g=e.next();if(g.done)break;h=g.value}h=h;h=h.val;h.emittedResult.status!==d("MAWChunkedObservableTypes.flow").ChunkResultState.LAZY&&(c<a+this.$3&&this.$9(h.start,b)<0?c+=h.emittedResult.arr.val.length:h.emittedResult.makeLazy())}};b.$18=function(a,b){var c=this.$1.next(b.ref),e;!c?(e=this.$17(a.start,a.end),this.$1.pushBack(e)):(e=this.$17(a.start,c.val.end),this.$1.mergeOver([e],c.ref));b.val.emittedResult.status!==d("MAWChunkedObservableTypes.flow").ChunkResultState.LAZY&&e.emittedResult.makeActive()};b.$12=function(){return Array.from(this.$1.iterFront()).reduce(function(a,b){b=b.val;return a+(b.emittedResult.status===d("MAWChunkedObservableTypes.flow").ChunkResultState.LAZY?0:b.emittedResult.arr.val.length)},0)};return a}();function h(a){return function(b,c){return a==="asc"?d("MAWObservableUtils").wrappedCompareKey(b,c):d("MAWObservableUtils").wrappedCompareKey(c,b)}}g.MAWChunkedRangeLoader=a}),98);
__d("MAWSimpleChunkedRangeLoader",["MAWFanOutObservable","MAWLiveQuery","MAWObservableUtils","combineLatestWith","justknobx"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b,c,d){this.$2=a,this.$5=d,this.$3=c.outputMapper,this.$4=c.querier,this.$7=c.getUniqueKey,this.$1=[],this.$6=h(d)}var b=a.prototype;b.queryRange=function(a,b,d,e){var f=this.$8(),g=this.$9();if(!(f&&g)){var h=(e==null?void 0:e.coverEntireRange)===!0?e==null?void 0:e.data:void 0;this.$1=[this.$10(a,b,Number.MAX_SAFE_INTEGER,c("justknobx")._("3534")?h:void 0)]}else if(this.$6(f.start,a)!==0||this.$6(g.end,b)>0){h=(e==null?void 0:e.coverEntireRange)===!0?e==null?void 0:e.data:void 0;this.$1=[this.$10(a,b,Number.MAX_SAFE_INTEGER,h)]}else g&&this.$6(g.end,b)<0&&this.$1.push(this.$10(g.end,b,Number.MAX_SAFE_INTEGER,e==null?void 0:e.data));return this.$11(d)};b.$11=function(a){var b=this;return c("combineLatestWith").apply(void 0,this.$1.map(function(a){a=a.observable;return a})).map(function(c){c=c.flat();var d=new Set();c=c.filter(function(a){a=b.$7(a);if(d.has(a))return!1;d.add(a);return!0});return c.slice(0,a)})};b.$10=function(a,b,c,e){var f=this,g;g=d("MAWFanOutObservable").buildFanoutObservable(d("MAWLiveQuery").createRawMAWObservable_DO_NOT_USE(this.$2,function(d){return f.$4(d)(a,b,c)},function(a){return a.map(f.$3)},"MAWSimpleObservableChunk - "+((g=JSON.stringify(a))!=null?g:"?")+":"+((g=JSON.stringify(b))!=null?g:"?")+"["+c+"]"),e?{initialValue:e}:{});return{end:b,observable:g,start:a}};b.$9=function(){if(!this.$1.length)return;return this.$1[this.$1.length-1]};b.$8=function(){if(!this.$1.length)return;return this.$1[0]};return a}();function h(a){return function(b,c){return a==="asc"?d("MAWObservableUtils").wrappedCompareKey(b,c):d("MAWObservableUtils").wrappedCompareKey(c,b)}}g.MAWSimpleChunkedRangeLoader=a}),98);
__d("MAWCreateChunkedRangeObservable",["MAWChunkedRangeLoader","MAWSimpleChunkedRangeLoader","qex"],(function(a,b,c,d,e,f,g){"use strict";var h=c("qex")._("383")?d("MAWChunkedRangeLoader").MAWChunkedRangeLoader:d("MAWSimpleChunkedRangeLoader").MAWSimpleChunkedRangeLoader,i=new WeakMap();function a(a,b,c,d,e,f){var g,j=b.callables,k=b.chunkSize,l=b.db;b=b.direction;g=(g=i.get(a))!=null?g:{asc:void 0,desc:void 0};if(g[b]==null){l=new h(l,k,j,b);g[b]=l;i.set(a,g);return l.queryRange(c,d,e,f)}return g[b].queryRange(c,d,e,f)}g.createMAWChunkedRangeObservable=a}),98);
__d("MAWCreateOptimisticSecureMessageWithAttachmentIDB",["I64","MAWBuildNewMsgPayload","MAWDbMsg","MAWIDBOptimisticMessageUtils","MAWOptimisticMessageUtils","MAWSendFileMsgTypes","QPLUserFlow","WAMediaHdType","asyncToGeneratorRuntime","nullthrows","qex","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=b.attachmentType,f=b.ephemeralSettings,g=b.initiatingSource,i=b.instanceKey,j=b.isHd,k=b.mawThreadResult,l=b.mediaGroupMetadataMap,m=b.messageExternalId,n=b.offlineAttachmentId,o=b.onOfflineMsgId,p=b.optimisticMediaAttachment,q=b.reply,r=b.senderId,s=b.threadKey;b=b.threadSource;o(m);o=d("MAWOptimisticMessageUtils").getOptimisticMessageTimestamp();var t=(h||(h=d("I64"))).of_float(o);q=q!=null?yield d("MAWIDBOptimisticMessageUtils").getQuoteByMsgId(c("nullthrows")(d("MAWDbMsg").toMsgId(q.messageId)),k.jid):{quote:void 0,quoteInfo:void 0};var u=q.quote;q=q.quoteInfo;var v=d("MAWOptimisticMessageUtils").buildMAWOptimisticBaseMsg({ephemeralSettings:f,externalId:m,threadJid:k.jid,ts:o});l=l==null?void 0:l.get(d("MAWSendFileMsgTypes").toOfflineAttachmentIDFromString(n));g=babelHelpers["extends"]({},d("MAWOptimisticMessageUtils").buildMAWBaseSendMsgArgs({content:"",initiatingSource:g||void 0,isFirstMsg:k.created,optimisticMsg:{msgId:m,ts:o},quote:u,threadSource:b}),{ephemeralSetting:f||void 0,hdType:c("qex")._("512")===!0?j===!0?d("WAMediaHdType").HD_TYPE_HQ_4K:d("WAMediaHdType").HD_TYPE_NONE:void 0,mediaGroupMetadata:l,offlineAttachmentId:n});u=d("MAWBuildNewMsgPayload").buildNewMsg(d("MAWOptimisticMessageUtils").lsAttachmentTypeToMsgType(e),v,g,q);b=(yield d("MAWIDBOptimisticMessageUtils").writeMsgToDb(u,k.jid));f=d("MAWOptimisticMessageUtils").buildOptimisticAttachment({attachmentType:e,isHd:j,messageExternalId:b,offlineAttachmentId:n,optimisticMediaAttachment:p,senderId:r,threadKey:s,timestampMsI64:t});yield a.attachments.add(f);c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"after_create_optimistic_message",{instanceKey:i});c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"optimistic_bump_thread_start",{instanceKey:i});yield d("MAWOptimisticMessageUtils").optimisticBumpThreadMedia(a,{optimisticMediaAttachment:p,senderId:r,threadKey:s,timestampMsI64:t});c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"optimistic_bump_thread_end",{instanceKey:i});return{messageExternalId:m,offlineAttachmentId:d("MAWSendFileMsgTypes").toOfflineAttachmentIDFromString(n),offlineMsgTimestamp:o}});return i.apply(this,arguments)}g.createIdbOptimisticMessageWithAttachment=a}),98);
__d("MAWCreateOptimisticsSecureMessageWithXMAAttachmentIDB",["I64","LSIntEnum","MAWAdminMsg","MAWBuildNewMsgPayload","MAWBumpThread","MAWDbMsg","MAWGetEphemeralSettings","MAWIDBOptimisticMessageUtils","MAWLocalizationType","MAWMsgType","MAWOptimisticMessageUtils","MAWSendFileMsgTypes","MAWVault","MessagingAttachmentType","QPLUserFlow","asyncToGeneratorRuntime","nullthrows","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,c,d,e,f,g,h,i,k,l,m,n,o,p,q,r){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,j,k,l,m,n,o,p,q,r,s,t,u){var v=(yield d("MAWGetEphemeralSettings").getEphemeralSetting(l.jid,f));m(n);m=d("MAWOptimisticMessageUtils").getOptimisticMessageTimestamp();var w=(h||(h=d("I64"))).of_float(m);e=e!=null?yield d("MAWIDBOptimisticMessageUtils").getQuoteByMsgId(c("nullthrows")(d("MAWDbMsg").toMsgId(e.messageId)),l.jid):{quote:void 0,quoteInfo:void 0};var x=e.quote;e=e.quoteInfo;var y=d("MAWOptimisticMessageUtils").buildMAWOptimisticBaseMsg({ephemeralSettings:v,externalId:n,threadJid:l.jid,ts:m});r=babelHelpers["extends"]({},d("MAWOptimisticMessageUtils").buildMAWBaseSendMsgArgs({content:q,initiatingSource:r||void 0,isFirstMsg:l.created,mentionedJids:t,optimisticMsg:{msgId:n,ts:m},quote:x,threadSource:s}),{ephemeralSetting:v||void 0,offlineAttachmentId:g,xmaMessageType:u});t=d("MAWBuildNewMsgPayload").buildNewMsg(d("MAWMsgType").MSG_TYPE.XMA,y,r,e);x=(yield d("MAWIDBOptimisticMessageUtils").writeMsgToDb(t,l.jid));s=d("MAWOptimisticMessageUtils").buildOptimisticAttachment({attachmentType:(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").XMA),messageExternalId:x,offlineAttachmentId:g,optimisticMediaAttachment:j,senderId:b,subtitleText:p,threadKey:f,timestampMsI64:w,titleText:o});yield a.attachments.add(s);c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"after_create_optimistic_message",{instanceKey:k});c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"optimistic_bump_thread_start",{instanceKey:k});yield d("MAWBumpThread").threadMutation_DEPRECATED({description:"MAWCreateOptimisticsSecureMessageWithXMAAttachmentIDB",lastActivityTs:w,lastReadTs:w,snippet:d("MAWAdminMsg").buildLocalizedString([d("MAWVault").unvault(q)],[],d("MAWLocalizationType").CURRENT_USER_SEND_TEXT),snippetSenderContactId:b,threadKey:f,txn:a});c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"optimistic_bump_thread_end",{instanceKey:k});return{messageExternalId:n,offlineAttachmentId:d("MAWSendFileMsgTypes").toOfflineAttachmentIDFromString(g),offlineMsgTimestamp:m}});return j.apply(this,arguments)}g["default"]=a}),98);
__d("MAWEditMsgHistoryUIConverter",["MAWBridgeEditMsgHistoryAddedHandler","MAWDbEditMsgHistory"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return babelHelpers["extends"]({},a,{editMsgHistoryId:d("MAWDbEditMsgHistory").convertToEditMsgHistoryId64(a.editMsgHistoryId),originalMsgId:b})}function i(a,b){return d("MAWBridgeEditMsgHistoryAddedHandler").composeEditHistoryMsg(a,b)}function a(a,b,c){a=h(a,b);return i(a,c)}g.mawToLS=a}),98);
__d("MAWMediaUIConverter",["MAWBridgeNewMediaHandler","MAWBridgeTypesCreators","MAWRavenUtils","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=d("WAJids").unsafeCoerceToChatJid("placeholder");function i(a){return d("MAWBridgeTypesCreators").createBridgeMedia(a)}function j(a,b,c){return i({chatJid:h,filteredMsgIds:[c.msgId],hasMediaForUI:b,media:a,ravenSettings:c.ravenEphemeralType!=null&&c.ravenEphemeralMediaState!=null?d("MAWRavenUtils").deriveRavenSettings(c.ravenEphemeralType,c.ravenEphemeralMediaState):null,sortOrderMs:d("WATimeUtils").castToMillisTime(c.sortOrderMs!=null?c.sortOrderMs:c.ts*1e3)})}function k(a,b,c){var e=b.mediaId,f=b.offlineAttachmentId,g=b.plaintextHash;e=d("MAWBridgeNewMediaHandler").getAttachmentID(e,g);return d("MAWBridgeNewMediaHandler").getAttachmentFromBridgeMedia(null,b,c,e,(g=f)!=null?g:e,a)}function a(a,b,c,d){if(d==null)return;d=j(d,b,c);if(d==null)return;return k(a,d,c.msgId)}g.bridgeToLS=k;g.mawToLS=a}),98);
__d("MAWMessageAttachmentCache",["CometLruCache","MAWAttachmentSizeUtils","justknobx"],(function(a,b,c,d,e,f,g){"use strict";f=c("justknobx")._("3443");var h=d("CometLruCache").create(f);function a(a){a=h.get(a.messageId);if(a==null)return null;var b=d("MAWAttachmentSizeUtils").getSizeFromAttachment(a),c=b.height;b=b.width;return{size:{height:c,width:b},type:a.attachmentType}}function b(a){return h.get(a.messageId)}function e(a,b){h.set(a,b)}g.getAttachmentSizeForMessage=a;g.getAttachmentForMessage=b;g.setAttachmentForMessage=e}),98);
__d("MAWMessageUIConverter",["I64","MAWAdminMsgCTA","MAWBridgeMsg","MAWBridgeMsgCountdown","MAWBridgeNewMsgHandler","MAWMsgReplySnippet"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){return d("MAWBridgeMsg").createBridgeMsg(a,void 0,b,void 0)}function j(a){return{ctaType:d("MAWAdminMsgCTA").getCtaTypeByAdminType(a.adminType),title:d("MAWAdminMsgCTA").getAdminMsgCTAContentByAdminType(a.adminType).title}}function a(a,b,c){c=i(b,c);a=d("MAWBridgeNewMsgHandler").composeMessage(a,c,j(c),d("MAWMsgReplySnippet").getReplySnippet(c));if(b.ephemeralCounterStarted===!0){c=d("MAWBridgeMsgCountdown").createBridgeMsgsStartCountdown([b]);b=c.msgs.length===1?c.msgs[0]:void 0;if(b!=null)return babelHelpers["extends"]({},a,{ephemeralExpirationTs:(h||(h=d("I64"))).of_float(b.countdownTs)})}return a}g.getAdminMsgCTA=j;g.mawToLS=a}),98);
__d("MAWReactionUIConverter",["MAWBridgeReactionUpsertHandler","MAWBridgeTypesCreators"],(function(a,b,c,d,e,f,g){"use strict";function h(a){var b=a.author,c=a.reaction,e=a.reactToMsgId,f=a.threadJid;a=a.ts;if(e==null||c==null)return;return d("MAWBridgeTypesCreators").createBridgeUpsertReaction({author:b,chatJid:f,reaction:c||"",reactToMsgId:e,ts:a})}function i(a,b){var c=a.actorId,e=a.messageId,f=a.reaction;a=a.ts;return d("MAWBridgeReactionUpsertHandler").composeReaction(c,b,e,a,f)}function a(a,b){a=h(a);if(a==null)return;return i(a,b)}g.bridgeToLS=i;g.mawToLS=a}),98);
__d("MAWReceiverFetchMediaUIConvertor",["MAWBridgeNewReceiverFetchInfoHandler","MAWBridgeReceiverFetchInfo"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){a=d("MAWBridgeReceiverFetchInfo").createBridgeReceiverFetchInfoPayloadFromDbInfo(a,b);return d("MAWBridgeNewReceiverFetchInfoHandler").composeAttachment(a,c,null)}g.mawToLS=a}),98);
__d("MAWXMAUIConvertor",["I64","MAWBridgeXMA","MAWBridgeXMAUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b,c,e,f){var g=f.attachmentCta1,h=f.attachmentCta2,i=f.attachmentCta3;f=f.defaultCta;return d("MAWBridgeXMAUtils").composeAttachmentXMA(a,e,b,c,g==null?void 0:g.ctaId,h==null?void 0:h.ctaId,i==null?void 0:i.ctaId,f==null?void 0:f.ctaId,"MAWXMAUIConvertor")}function j(a,b,c,e){var f=a.ctas,g=a.defaultCTA,i=a.xmaId,j=d("MAWBridgeXMAUtils").maybeBridgeToLSTargetId(a.targetId),k=(h||(h=d("I64"))).of_int32(i),l={};g!=null&&(l.defaultCta=d("MAWBridgeXMAUtils").composeDefaultAttachmentCta(g,k,c,e,b,j,a.targetType));f!=null&&f.map(function(a,f){var g=d("MAWBridgeXMAUtils").getCtaIdFromDefaultCtaId(k,f);a=d("MAWBridgeXMAUtils").composeAttachmentCta(a,g,c,e,b,j);f===0?l.attachmentCta1=a:f===1?l.attachmentCta2=a:f===2&&(l.attachmentCta3=a)});return l}function a(a,b,c,e,f){b=d("MAWBridgeXMA").createBridgeXMA(b,f,{hasMedia:a,hasXmaFaviconMedia:!1,hasXmaHeaderMedia:!1});f=String(b.xmaId);a=j(b,f,c,e);b=i(b,f,c,e,a);return{attachment:b,attachmentCTAs:a}}g.bridgeXMAtoLSAttachment=i;g.bridgeXMAtoLSAttachmentCTAs=j;g.mawToLS=a}),98);
__d("MAWMessagesLiveQuery",["I64","MAWCreateChunkedRangeObservable","MAWDbMediaTxns","MAWDbMsg","MAWDbReactionsTxns","MAWDbXMATxns","MAWDexieTable","MAWJidUtils","MAWLiveQuery","MAWLoadMessagesRequest","MAWLoadMsgsDedupper","MAWLoadMsgsUtil","MAWLoadReplyMediaTxns","MAWMediaUIConverter","MAWMessageAttachmentCache","MAWMessageUIConverter","MAWMessagesDirection","MAWReactionUIConverter","MAWReceiverFetchMediaUIConvertor","MAWXMAUIConvertor","MAWXMAUtils","MLV2DataSourceLogger","MessagesRangesV2ExternalIds","Random","WATimeUtils","gkx","justknobx","nullthrows","qex","relay-runtime/network/RelayObservable"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b,e,f,g,h,i){var k;h===void 0&&(h=!1);(k=i())==null?void 0:k.markQPLPoint("request_dexie_transaction");return a.openReadonlyTransaction("messagesQuery",["messages","media","chunk","xma","receiverFetchInfo","reactions"],function(a){var k,l=i();(k=i())==null?void 0:k.markQPLPoint("inside_dexie_transaction");k=l!=null&&d("Random").coinflip(c("justknobx")._("3543"));l==null?void 0:l.addQPLAnnotations({bool:{live_query_track_lock:k}});k=k?a.messages.get("").then(function(){l==null?void 0:l.markQPLPoint("live_query_lock_acquired")}):d("MAWDexieTable").dexieResolve();return k.then(function(){var c;return n({messages:a.messages},b,{gte:(c=e.gte)!=null?c:[Number.MIN_VALUE,d("MessagesRangesV2ExternalIds").MIN_EXTERNAL_ID],lte:(c=e.lte)!=null?c:[Number.MAX_VALUE,d("MessagesRangesV2ExternalIds").MAX_EXTERNAL_ID]},f,g,h)}).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){return j(a,b)}))})})}function j(a,b){return d("MAWDexieTable").dexieAll([d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b,!0),d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,b.mediaId),k(a,b),l(a,b),m(a,b)]).then(function(a){var c=a[0],d=a[1],e=a[2],f=a[3];a=a[4];return{media:d,msg:b,reactions:a,receiverFetchInfo:e,replyAttachment:c,xmaData:f}})}function k(a,b){b=b==null?void 0:b.receiverFetchId;return b==null?d("MAWDexieTable").dexieResolve():a.receiverFetchInfo.get(b)}function l(a,b){var e;if(!d("MAWDbMsg").isXMAMsg(b)||d("MAWXMAUtils").isReceiverFetchXMA(b.xmaMessageType)||!((e=c("qex")._("1595"))!=null?e:!1)||!((e=c("qex")._("1599"))!=null?e:!1))return d("MAWDexieTable").dexieResolve();e=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.threadJid,b.externalId);return d("MAWDbXMATxns").maybeGetXMAAndDefaultPreviewMediaFromProtocolMsg(a,e)}function m(a,b){var e;return!(((e=c("qex")._("1599"))!=null?e:!1)&&((e=c("qex")._("99"))!=null?e:!1))?d("MAWDexieTable").dexieResolve([]):d("MAWDbReactionsTxns").getReactionsForMessage(a,b)}function n(a,b,e,f,g,h){var i,j=c("MAWLoadMsgsDedupper")(),k=g==="desc"&&h,l=g==="asc"&&h,m=e.gte;m=m[0];var n=e.lte;n=n[0];var p=(i=c("qex")._("1262"))!=null?i:!1;i=a.messages.where(["threadJid","sortOrderMs"]).between([b,m],[b,n],p||!k,p||!l);if(c("gkx")("1803"))return i.toArray().then(function(a){var b=d("MAWMessagesDirection").switchOnMWPMessagesDirection(g,{asc:a,desc:a.reverse()}).filter(function(a){return!d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType)&&(a.messageExpirationTs==null||a.messageExpirationTs>d("WATimeUtils").unixTime())&&a.ephemeralMsgDisappeared!==!0}).filter(j).filter(function(a){return c("justknobx")._("3227")?a.source!=="media_restore":a!=null});return p?o(a,e,g,f,h):b.slice(0,f)});else{a=d("MAWMessagesDirection").switchOnMWPMessagesDirection(g,{asc:i,desc:i.reverse()}).filter(function(a){return!d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType)&&(a.messageExpirationTs==null||a.messageExpirationTs>d("WATimeUtils").unixTime())&&a.ephemeralMsgDisappeared!==!0}).filter(j).filter(function(a){return c("justknobx")._("3227")?a.source!=="media_restore":a!=null});if(p){m=d("MAWLoadMsgsUtil").makeUntilWithRangeExtensionBothDirections(f);return a.until(m).toArray().then(function(a){return o(a,e,g,f,h)})}return a.limit(f).toArray()}}function o(a,b,c,e,f){var g=d("MAWMessagesDirection").switchOnMWPMessagesDirection(c,{asc:[b.gte,b.lte],desc:[b.lte,b.gte]});g[0];g=g[1];var h=g[0];g=g[1];a=d("MAWLoadMessagesRequest").getMsgsForBounds(a,b,d("MAWMessagesDirection").translateMwpDirectionToMawDirection(c),e);if(!f||a.length===0)return a;b=a[a.length-1];return g!==d("MessagesRangesV2ExternalIds").MIN_EXTERNAL_ID&&g!==d("MessagesRangesV2ExternalIds").MAX_EXTERNAL_ID?g===b.externalId?a.slice(0,-1):a:b.sortOrderMs===h?a.slice(0,-1):a}function p(a,b){var e=a.media,f=a.msg,g=a.reactions,h=a.receiverFetchInfo,i=a.replyAttachment;a=a.xmaData;var j,k;if(a){a=d("MAWXMAUIConvertor").mawToLS(a.hasMedia,a.previewMedia,f.msgId,b,a.xma);j=a.attachment;k=a.attachmentCTAs}else e?j=d("MAWMediaUIConverter").mawToLS(b,!0,f,e):h&&(j=d("MAWReceiverFetchMediaUIConvertor").mawToLS(f,h,b));a=g.map(function(a){return d("MAWReactionUIConverter").mawToLS(a,b)}).filter(Boolean);e=d("MAWMessageUIConverter").mawToLS(b,f,i);h=[e.primarySortKey,e.messageId];i=(g=c("qex")._("1599"))!=null?g:!1;if(i){g={attachmentCTAs:k?[k]:[],attachmentItems:[],attachments:j?[j]:[]};i={attachmentData:g,reactions:a};return[h,{associatedData:i,message:e}]}else{j!=null&&d("MAWMessageAttachmentCache").setAttachmentForMessage(f.msgId,j);return[h,{message:e}]}}function a(a){var b=a.bounds,e=a.count,g=a.direction,j=a.disableLogging;j=j===void 0?!1:j;var k=a.isInitialPlaceholderRange,l=a.jid,m=a.mawDb,n=a.threadKey;a=j?void 0:d("MLV2DataSourceLogger").getMLV2LoggerForThread(n,g);a==null?void 0:a.addQPLAnnotations({string:{liveQueryType:"unchunked"}});if(k){var o=i(m,l,{gte:[(h||(h=d("I64"))).to_float(b.gte[0]),b.gte[1]],lte:[h.to_float(b.lte[0]),b.lte[1]]},e,g,!1,function(){}).then(function(a){return a.map(function(a){return p(a,n)})});a==null?void 0:a.markQPLPoint("create_non_reactive_observable");return c("relay-runtime/network/RelayObservable").create(function(a){o.then(function(b){return a.next(b)})["catch"](function(b){return a.error(b)})})}a==null?void 0:a.markQPLPoint("create_reactive_observable");return d("MAWLiveQuery").createMawObservable(m,function(a){return i(a,l,{gte:[(h||(h=d("I64"))).to_float(b.gte[0]),b.gte[1]],lte:[h.to_float(b.lte[0]),b.lte[1]]},e,g,!1,function(){return d("MLV2DataSourceLogger").getMLV2LoggerForThread(n,g)})},function(a){return a.map(function(a){return p(a,n)})},f.id+":484")}function q(a,b){return d("MAWMessagesDirection").switchOnMWPMessagesDirection(a,{asc:[[(h||(h=d("I64"))).to_float(b.gte[0]),b.gte[1]],[h.to_float((h||(h=d("I64"))).equal((h||(h=d("I64"))).max_int,b.lte[0])?b.lte[0]:(h||(h=d("I64"))).add(b.lte[0],(h||(h=d("I64"))).one)),d("MessagesRangesV2ExternalIds").MAX_EXTERNAL_ID]],desc:[[h.to_float(b.lte[0]),b.lte[1]],[h.to_float((h||(h=d("I64"))).equal((h||(h=d("I64"))).min_int,b.gte[0])?b.gte[0]:(h||(h=d("I64"))).add(b.gte[0],(h||(h=d("I64"))).neg_one)),d("MessagesRangesV2ExternalIds").MIN_EXTERNAL_ID]]})}function b(a){var b=a.bounds,e=a.cacheKey,f=a.count,g=a.direction,j=a.disableLogging;j=j===void 0?!1:j;var k=a.jid,l=a.mawDb,m=a.pageSize,n=a.prefetchedMessages,o=a.threadKey;j=j?void 0:d("MLV2DataSourceLogger").getMLV2LoggerForThread(o,g);j==null?void 0:j.addQPLAnnotations({string:{liveQueryType:"chunked"}});if(a.isInitialPlaceholderRange){var r=i(a.mawDb,a.jid,{gte:[(h||(h=d("I64"))).to_float(a.bounds.gte[0]),a.bounds.gte[1]],lte:[h.to_float(a.bounds.lte[0]),a.bounds.lte[1]]},a.count,a.direction,!1,function(){}).then(function(b){return b.map(function(b){return p(b,a.threadKey)})});j==null?void 0:j.markQPLPoint("create_non_reactive_observable");return c("relay-runtime/network/RelayObservable").create(function(a){r.then(function(b){return a.next(b)})["catch"](function(b){return a.error(b)})})}n=n==null?null:{coverEntireRange:n.coverEntireRange,data:n.data.map(function(a){return[[a.message.primarySortKey,a.message.messageId],a]})};j==null?void 0:j.markQPLPoint("create_reactive_observable");j=q(g,b);b=j[0];j=j[1];return d("MAWCreateChunkedRangeObservable").createMAWChunkedRangeObservable(e,{callables:{accumDedup:function(){var a=new Set();return function(b){b=JSON.stringify(b[0]);if(a.has(b))return!1;a.add(b);return!0}},getSortKey:function(a){a=a.msg;return[c("nullthrows")(a.sortOrderMs),a.externalId]},getUniqueKey:function(a){var b=a[0];a[1];return b[1]},outputMapper:function(a){return p(a,o)},querier:function(a){return function(b,c,e){return i(a,k,d("MAWMessagesDirection").switchOnMWPMessagesDirection(g,{asc:{gte:b,lte:c},desc:{gte:c,lte:b}}),e,g,!0,function(){return d("MLV2DataSourceLogger").getMLV2LoggerForThread(o,g)})}}},chunkSize:m,db:l,direction:g},b,j,f,(e=n)!=null?e:void 0)}e=((e=c("qex")._("1612"))!=null?e:!1)||((e=c("qex")._("478"))!=null?e:!1)?b:a;g.getMessagesForThread=n;g.adjustBounds=q;g.MAWMessagesLiveQuery=e}),98);
__d("MWPOptimisticMessageObservable",["I64","LSAuthorityLevel","LSIntEnum","ReQL","ReQLObservable"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b){var e=d("ReQL").fromTableAscending(a.tables.messages.index("messageDisplayOrderAuthority")).bounds({gte:[b,(h||(h=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC),(i||(i=d("I64"))).zero],lt:[b,h.ofNumber(c("LSAuthorityLevel").OPTIMISTIC),i.max_int]}).map(function(a){return{message:a}});return d("ReQLObservable").create(a,function(){return e})}g["default"]=a}),98);
__d("useSecureAttachmentDefaultPlaceholderSize",["I64","LSIntEnum","MWPAudioPlayerUtils","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){var b=d("react-compiler-runtime").c(8);if(b[0]!==a.ephemeralDurationInSec){var c;c=(h||(h=d("I64"))).gt((c=a.ephemeralDurationInSec)!=null?c:(h||(h=d("I64"))).zero,h.zero);b[0]=a.ephemeralDurationInSec;b[1]=c}else c=b[1];c=c;c=d("MWPAudioPlayerUtils").useCalculatePlayerWidth(void 0,c);var e=d("MWPAudioPlayerUtils").useCalculatePlayerHeight(d("MWPAudioPlayerUtils").UseCase.PLAYER);if((h||(h=d("I64"))).equal(a.displayedContentTypes,(i||(i=d("LSIntEnum"))).ofNumber(4))){var f;b[2]!==e||b[3]!==c?(f={height:e,width:c},b[2]=e,b[3]=c,b[4]=f):f=b[4];return f}if((h||(h=d("I64"))).equal(a.displayedContentTypes,(i||(i=d("LSIntEnum"))).ofNumber(64))){b[5]===Symbol["for"]("react.memo_cache_sentinel")?(e={height:60,width:250},b[5]=e):e=b[5];return e}if((h||(h=d("I64"))).equal(a.displayedContentTypes,(i||(i=d("LSIntEnum"))).ofNumber(4096))||(h||(h=d("I64"))).equal(a.displayedContentTypes,(i||(i=d("LSIntEnum"))).ofNumber(134217728))){b[6]===Symbol["for"]("react.memo_cache_sentinel")?(c={height:128,width:128},b[6]=c):c=b[6];return c}b[7]===Symbol["for"]("react.memo_cache_sentinel")?(f={height:200,width:480},b[7]=f):f=b[7];return f}g["default"]=a}),98);
__d("MWV2AttachmentLoadingPlaceholderForSeparateRead.react",["MAWAttachmentSizeUtils","MAWMessageAttachmentCache","MWLSThreadDisplayContext","MWV2AttachmentLoadingPlaceholder.react","react","react-compiler-runtime","useSecureAttachmentDefaultPlaceholderSize"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(13),e=a.connectBottom,f=a.connectTop,g=a.mediaRenderQpl,h=a.message;a=a.outgoing;var j=c("useSecureAttachmentDefaultPlaceholderSize")(h),k=j.height;j=j.width;var l=d("MWLSThreadDisplayContext").useMWLSThreadDisplayContext(),m;if(b[0]!==l||b[1]!==h){var n=d("MAWMessageAttachmentCache").getAttachmentSizeForMessage(h);m=n==null?void 0:n.size;n=n==null?{maxHeight:void 0,maxWidth:void 0}:d("MAWAttachmentSizeUtils").getMaxSize(n,l);b[0]=l;b[1]=h;b[2]=m;b[3]=n}else m=b[2],n=b[3];l=n;h=l.maxHeight;n=l.maxWidth;l=(l=(l=m)==null?void 0:l.height)!=null?l:k;k=(m=(k=m)==null?void 0:k.width)!=null?m:j;b[4]!==e||b[5]!==f||b[6]!==h||b[7]!==n||b[8]!==g||b[9]!==a||b[10]!==l||b[11]!==k?(m=i.jsx(c("MWV2AttachmentLoadingPlaceholder.react"),{connectBottom:e,connectTop:f,descriptionForLogging:"MAWSecureAttachment.react.separate_read",hasAppAttribution:!1,height:l,maxHeight:h,maxWidth:n,mediaRenderQpl:g,outgoing:a,width:k}),b[4]=e,b[5]=f,b[6]=h,b[7]=n,b[8]=g,b[9]=a,b[10]=l,b[11]=k,b[12]=m):m=b[12];return m}g["default"]=a}),98);
__d("useMawDbInUI",["LSSuspense","MAWIndexedDbUI","MAWStateContext.react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||(h=c("LSSuspense"))).makeCollection();function a(){var a=d("react-compiler-runtime").c(1),b=d("MAWStateContext.react").useMAWSelector(k);if(b){a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b=(h||(h=c("LSSuspense"))).getFromCollection(i,d("MAWIndexedDbUI").MawDbInUISingleton,j),a[0]=b):b=a[0];return b}}function j(){return d("MAWIndexedDbUI").MawDbInUISingleton}function k(a){return a.isMAWDBinUILoaded}g["default"]=a}),98);
__d("useEditMessageHistoryMAW",["MAWChatJid","MAWDbMsg","MAWEditMsgHistoryUIConverter","MAWLiveQuery","asyncToGeneratorRuntime","nullthrows","react","react-compiler-runtime","useAsyncReStore","useMawDbInUI","useObservable"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useMemo;function a(a,e){var f=d("react-compiler-runtime").c(9),g=c("useMawDbInUI")(),h=c("useAsyncReStore")(),j;f[0]!==h||f[1]!==g||f[2]!==a?(j=function(){return d("MAWLiveQuery").createMawObservable(g,function(b){return b.openReadonlyTransaction("useEditMessageHistoryMAW",["messages","editMsgHistory"],function(b){return b.messages.where("msgId").equals(c("nullthrows")(d("MAWDbMsg").toMsgId(a))).first().then(function(a){if(a==null||a.editCount===0)return;return b.editMsgHistory.where(["originalMsgExternalId","threadJid"]).equals([a.externalId,a.threadJid]).toArray().then(function(b){b=b.sort(i).slice(0,-1);return{editMsgHistory:b,threadJid:a.threadJid}})})})},function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){if(b==null)return;var e=(yield h),f=(yield d("MAWChatJid").toThreadKey(e.tables,b.threadJid,"useEditMessageHistoryMAW"));return b.editMsgHistory.map(function(b){return d("MAWEditMsgHistoryUIConverter").mawToLS(b,c("nullthrows")(d("MAWDbMsg").toMsgId(a)),f)})});return function(a){return e.apply(this,arguments)}}())},f[0]=h,f[1]=g,f[2]=a,f[3]=j):j=f[3];var k;f[4]!==e||f[5]!==j?(k=d("MAWLiveQuery").maybeCreate(e,j),f[4]=e,f[5]=j,f[6]=k):k=f[6];e=k;j=e;k=c("useObservable")(j);e=k[0];if(f[7]!==e){k=(j=e)!=null?j:[];f[7]=e;f[8]=k}else k=f[8];return k}function i(a,b){return a.editTs-b.editTs}g["default"]=a}),98);
__d("useGetReactionsMaybeFromContextMAW",["MAWMessageAssociatedDataContext","cr:7020","qex","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useContext;function a(a,e){var f=i(d("MAWMessageAssociatedDataContext").MAWMessageAssociatedDataContext).reactions;a=b("cr:7020")(a,e);e=(e=c("qex")._("1599"))!=null?e:!1;e=e?f:a;return e}g["default"]=a}),98);
__d("useMAWCreateOptimisticSecureMessageInIDB",["FBLogger","I64","MAWBuildNewMsgPayload","MAWDbMsg","MAWIDBOptimisticMessageUtils","MAWMsgType","MAWOptimisticMessageUtils","MWPActor.react","Promise","QPLUserFlow","asyncToGeneratorRuntime","clearTimeout","nullthrows","qpl","react","react-compiler-runtime","setTimeout","useAsyncReStore","useLSMessagingInitiatingSourceNumber","useMWLSDefaultThreadSource"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;(i||d("react")).useCallback;var k=1e3;function a(){var a=d("react-compiler-runtime").c(5),e=d("MWPActor.react").useActor(),g=c("useAsyncReStore")(),i=c("useLSMessagingInitiatingSourceNumber")(),l=c("useMWLSDefaultThreadSource")(),m;a[0]!==g||a[1]!==l||a[2]!==i||a[3]!==e?(m=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,m,n,o,p,q,r,s,t,u){c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"before_create_optimistic_message",{instanceKey:q});var v=d("MAWOptimisticMessageUtils").getOptimisticMessageTimestamp(),w=(j||(j=d("I64"))).of_float(v);a=a!=null?yield d("MAWIDBOptimisticMessageUtils").getQuoteByMsgId(c("nullthrows")(d("MAWDbMsg").toMsgId(a.messageId)),o.jid):{quote:void 0,quoteInfo:void 0};var x=a.quote;a=a.quoteInfo;var y=d("MAWOptimisticMessageUtils").getSpecialTextSize(p);u=babelHelpers["extends"]({},d("MAWOptimisticMessageUtils").buildMAWOptimisticBaseMsg({ephemeralSettings:u,externalId:t,threadJid:o.jid,ts:v}),{specialTextSize:y});x=babelHelpers["extends"]({},d("MAWOptimisticMessageUtils").buildMAWBaseSendMsgArgs({content:m,initiatingSource:i,isFirstMsg:o.created,mentionedJids:r,optimisticMsg:{msgId:t,ts:v},quote:x,threadSource:l(n)}),{specialTextSize:y});y=d("MAWBuildNewMsgPayload").buildNewMsg(d("MAWMsgType").MSG_TYPE.TEXT,u,x,a);var z;u=new(h||(h=b("Promise")))(function(a){z=c("setTimeout")(function(){c("FBLogger")("messenger_e2ee_web").mustfix("Timeout create optimistic message in MAWDB"),a()},k)});yield h.race([u,d("MAWIDBOptimisticMessageUtils").writeMsgToDb(y,o.jid)]);c("clearTimeout")(z);s(t);c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"after_create_optimistic_message",{instanceKey:q});c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"optimistic_bump_thread_start",{instanceKey:q});yield (yield g).runInTransaction(function(a){return d("MAWOptimisticMessageUtils").optimisticBumpThread(a,{hotEmojiSize:p,mentionedJids:r,messageText:m,senderId:e,threadKey:n,ts:w})},"readwrite","ui",void 0,f.id+":161");c("QPLUserFlow").addPoint(c("qpl")._(25313175,"1551"),"optimistic_bump_thread_end",{instanceKey:q});return{messageExternalId:t,offlineMsgTimestamp:v}});return function(b,c,d,e,f,g,h,i,j,k){return a.apply(this,arguments)}}(),a[0]=g,a[1]=l,a[2]=i,a[3]=e,a[4]=m):m=a[4];return m}g["default"]=a}),98);
__d("useMAWSelectedMessage",["MAWDbMsg","MAWLiveQuery","MAWMessageUIConverter","react","react-compiler-runtime","relay-runtime/network/RelayObservable","useMawDbInUI","useObservable"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useMemo;function a(a,b,e){var g=d("react-compiler-runtime").c(8),h=c("useMawDbInUI")(),i;bb0:{if(a==null){var j;g[0]===Symbol["for"]("react.memo_cache_sentinel")?(j=c("relay-runtime/network/RelayObservable").from(),g[0]=j):j=g[0];i=j;break bb0}if(g[1]!==e||g[2]!==h||g[3]!==a||g[4]!==b){var k=d("MAWDbMsg").toMsgId(a);if(k==null){g[7]===Symbol["for"]("react.memo_cache_sentinel")?(j=c("relay-runtime/network/RelayObservable").from(),g[7]=j):j=g[7];i=j;break bb0}j=d("MAWLiveQuery").maybeCreate(e,function(){return d("MAWLiveQuery").createMawObservable(h,function(a){return a.openReadonlyTransaction("useMAWSelectedMessage",["messages"],function(a){return a.messages.where("msgId").equals(k).first()})},function(a){return a!=null?d("MAWMessageUIConverter").mawToLS(b,a,void 0):null},f.id+":43")});g[1]=e;g[2]=h;g[3]=a;g[4]=b;g[5]=j;g[6]=i}else j=g[5],i=g[6];i=j}e=i;a=c("useObservable")(e);g=a[0];if(g!=null)return g}g["default"]=a}),98);
__d("useMarkOptimisticMessagesAsFailedIDB",["MAWIDBOptimisticMessageUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(){return h}function h(a,b,c,d){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){yield d("MAWIDBOptimisticMessageUtils").markMessageSendAsFailed(a,c,e)});return i.apply(this,arguments)}g["default"]=a}),98);
__d("useMediaMAW",["FBLogger","MAWDbMedia","MAWDbMsg","MAWGetAttachmentThumbnailBlob","MAWLiveQuery","MAWMediaUIConverter","MAWMessageAttachmentCache","MAWMsg","nullthrows","react","react-compiler-runtime","relay-runtime/network/RelayObservable","useMawDbInUI","useObservable"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useMemo;function a(a,b){var e=d("react-compiler-runtime").c(12),g=c("useMawDbInUI")(),h;bb0:{if(e[0]!==b||e[1]!==g||e[2]!==a){var i=d("MAWDbMsg").toMsgId(a.messageId);if(i==null){b&&c("FBLogger")("messenger_e2ee_web").warn("[useMediaAttachmentsMAW]] unexpected messageId format: %s",a.messageId);var k;e[5]===Symbol["for"]("react.memo_cache_sentinel")?(k=c("relay-runtime/network/RelayObservable").from(),e[5]=k):k=e[5];h=k;break bb0}e[6]!==b||e[7]!==a?(k=b&&d("MAWMsg").isMediaMsg(a)&&!d("MAWMsg").isReceiverFetchMsg(a)&&!d("MAWMsg").isXMAMsg(a),e[6]=b,e[7]=a,e[8]=k):k=e[8];k=d("MAWLiveQuery").maybeCreate(k,function(){return d("MAWLiveQuery").createMawObservable(g,function(a){return a.openReadonlyTransaction("useMediaMAW",["messages","media"],function(a){return a.messages.where("msgId").equals(i).first().then(function(b){var d=b==null?void 0:b.mediaId;if(d==null)return;return a.media.get(d).then(function(a){return{dbMsg:c("nullthrows")(b),hasMediaForUI:!0,media:a}})})})},function(b){if(b==null)return;var c=b.dbMsg,e=b.hasMediaForUI;b=b.media;e=d("MAWMediaUIConverter").mawToLS(a.threadKey,e,c,b);e!=null&&b!=null&&j(a.messageId,b);return{attachment:e,media:b}},f.id+":62")});e[0]=b;e[1]=g;e[2]=a;e[3]=k;e[4]=h}else k=e[3],h=e[4];h=k}b=h;k=c("useObservable")(b);b=k[0];if(e[9]!==(b==null?void 0:b.attachment)||e[10]!==a){k=(k=b==null?void 0:b.attachment)!=null?k:d("MAWMessageAttachmentCache").getAttachmentForMessage(a);e[9]=b==null?void 0:b.attachment;e[10]=a;e[11]=k}else k=e[11];b=k;return b}function i(a,b,c){if(b.blobData==null||b.mimetype==null)return;b=new Blob([b.blobData],{type:b.mimetype});b=URL.createObjectURL(b);c(a,b)}function j(a,b){if(b.mediaType===d("MAWDbMedia").MEDIA_TYPE.IMAGE||b.mediaType===d("MAWDbMedia").MEDIA_TYPE.VIDEO){b=k(b);b=b.thumbnailBlob;i(a,{blobData:b,mimetype:"image/jpeg"},d("MAWGetAttachmentThumbnailBlob").setEagerThumbnailUrl)}}function k(a){var b,c=null;switch(a.mediaType){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:c=(b=a.validatedImageInfo)==null?void 0:b.jpegThumbnail;break;case d("MAWDbMedia").MEDIA_TYPE.VIDEO:c=(b=a.validatedVideoInfo)==null?void 0:b.jpegThumbnail;break}return{thumbnailBlob:c,thumnailPlaintextHash:null}}g["default"]=a}),98);
__d("useReceiverFetchMediaMAW",["FBLogger","MAWDbMsg","MAWLiveQuery","MAWMessageAttachmentCache","MAWMsg","MAWReceiverFetchMediaUIConvertor","react","react-compiler-runtime","relay-runtime/network/RelayObservable","useMawDbInUI","useObservable"],(function(a,b,c,d,e,f,g){"use strict";var h;(h||d("react")).useMemo;function a(a,b){var e=d("react-compiler-runtime").c(12),g=c("useMawDbInUI")(),h;bb0:{if(e[0]!==b||e[1]!==g||e[2]!==a){var i=d("MAWDbMsg").toMsgId(a.messageId);if(i==null){b&&c("FBLogger")("messenger_e2ee_web").warn("[useReceiverFetchMediaMAW]] unexpected messageId format: %s",a.messageId);var j;e[5]===Symbol["for"]("react.memo_cache_sentinel")?(j=c("relay-runtime/network/RelayObservable").from(),e[5]=j):j=e[5];h=j;break bb0}e[6]!==b||e[7]!==a?(j=b&&d("MAWMsg").isReceiverFetchMsg(a),e[6]=b,e[7]=a,e[8]=j):j=e[8];j=d("MAWLiveQuery").maybeCreate(j,function(){return d("MAWLiveQuery").createMawObservable(g,function(a){return a.openReadonlyTransaction("useReceiverFetchMediaMAW",["messages","receiverFetchInfo"],function(a){return a.messages.where("msgId").equals(i).first().then(function(b){var d=b==null?void 0:b.receiverFetchId;if(b==null||d==null)return;return a.receiverFetchInfo.get(d).then(function(a){if(a==null){c("FBLogger")("messenger_e2ee_web").warn("[useReceiverFetchMediaMAW] unexpected missing receiverFetchInfo for msg");return}return{msg:b,receiverFetchInfo:a}})})})},function(b){if(b==null)return;var c=b.msg;b=b.receiverFetchInfo;return d("MAWReceiverFetchMediaUIConvertor").mawToLS(c,b,a.threadKey)},f.id+":46")});e[0]=b;e[1]=g;e[2]=a;e[3]=j;e[4]=h}else j=e[3],h=e[4];h=j}b=h;j=c("useObservable")(b);b=j[0];if(e[9]!==b||e[10]!==a){j=(j=b)!=null?j:d("MAWMessageAttachmentCache").getAttachmentForMessage(a);e[9]=b;e[10]=a;e[11]=j}else j=e[11];b=j;return b}g["default"]=a}),98);